{% load lang %}
<script type="text/javascript" src="/static/js/jquery-1.4.1.js"></script>
<script type="text/javascript">
var district_sel = {{ district_sel }};
var subdistrict_sel = {{ subdistrict_sel }};
var village_sel = {{ village_sel }};
$(function(){
    if ($('#fdistrict').length){
    	// dependen dropdown
    	$('#district').bind('change',function(){
    			var me = this[this.selectedIndex];
    			if(me.value !=""){
    				$.ajax({
    					type: 'GET',
    					url:'/livecenter/district/'+$(me).val(),
    					success:function(json){
    						var data = eval('(' + json + ')');
    						$('#sub_district').empty()
                            $('#sub_district').append($('<option />').val("").text('{% t "Pilih kecamatan" %}'));
    						for(var i = 0;i< data.length;i++){
    							$('#sub_district').append($('<option />').val(data[i].dl_id).text(data[i].dl_name));
    						}
    						if (subdistrict_sel){
    							$('#sub_district').val('0');
    							$('#sub_district').val(subdistrict_sel);
    							$('#sub_district').change();
    						}
    					},
    					error:function(){
    						alert('error guys')
    					}
    				});	
    			}
    	});
    	//var addBinding = function(){
    		$('#sub_district').bind('change',function(){
    			var me = this[this.selectedIndex];
    			if(me.value !=""){
    				$.ajax({
    					type: 'GET',
    					url:'/livecenter/district/'+$(me).val(),
    					success:function(json){
    						var data = eval('(' + json + ')');
    						$('#village').empty()
                            $('#village').append($('<option />').val("").text('{% t "Pilih desa" %}'));
    						for(var i = 0;i< data.length;i++){
    							$('#village').append($('<option />').val(data[i].dl_id).text(data[i].dl_name));	
    						}
    						if (village_sel){
    							$('#village').val('0');
    							$('#village').val(village_sel);
    							$('#village').change();
    						}
    					},
    					error:function(){
    						alert('error guys')
    					}
    				});	
    			}
    		});
    	//};
    	
    	if (district_sel) {
    	   _ds = $('#district');
    	   _ds.val(district_sel);
    	   _ds.change();
        }

	}

	function setGeoPos(){
		n1 = $('#n1').val();
		n2 = ($('#n2').val()/60);
		e1 = $('#e1').val();
		e2 = ($('#e2').val()/60);
		var n = 0;
		n = (Number(n1)+Number(n2)).toString();
		var e = 0;
		e = (Number(e1)+Number(e2)).toString();
		$('#geo_pos').val(n+","+e);
	}
	$('#n1').bind('keyup',function(){
		setGeoPos();
	});
	$('#n2').bind('keyup',function(){
		setGeoPos();
	});
	$('#e1').bind('keyup',function(){
		setGeoPos();
	});
	$('#e2').bind('keyup',function(){
		setGeoPos();
	});

	var pos = $('#geo_pos').val();
	if( $('#geo_pos').length && pos ){
		geopoint = pos.split(',');
		n1val = geopoint[0].split(".")[0];
		n2val = "0."+geopoint[0].split(".")[1];
		e1val = geopoint[1].split(".")[0];
		e2val = "0."+geopoint[1].split(".")[1];
		$('#n1').val(n1val);
		$('#n2').val(Number(n2val)*60);
		$('#e1').val(e1val);
		$('#e2').val(Number(e2val)*60);
		//alert(n1val+'-'+n2val+'-'+e1val+'-'+e2val);
	}

});
</script>

<p>
<fieldset id="fdistrict"><legend>{% t "Lokasi" %}</legend>
    <span>
        <label for="district">{% t "Kabupaten" %}</label>
	<select name="district" id="district" required="required">
        <option value="0">{% t "Pilih" %}</option>
	{% for district in districts %}
	<option value="{{district.dl_id}}" {%if district.dl_id == district_sel %}selected="selected"{%endif%}>{{district.dl_name}}</option>
	{% endfor %}
	</select>
	</span>
	<span>
        <label>{% t "Kecamatan" %}</label>
	<select id="sub_district" name="sub_district" required="required">
        <option value="">{% t "Pilih" %}</option>
	</select>
	</span>
	<span>
        <label>{% t "Desa" %}</label>
	<select id="village" name="village" required="required">
        <option value="">{% t "Pilih" %}</option>
	</select>
	</span>
</fieldset>
</p>
<p>
<fieldset id="fgeopos"><legend>{% t "Koordinat GPS" %}</legend>
    <span>{% t "Utara" %}</span> : <input name="n1" id="n1" type="text" class="auto" alt="n3x3p0S" size="3" />
      <input name="n2" id="n2" type="text" class="auto" alt="n2x3p4S" size="10" /> &nbsp;
      <span>{% t "Timur" %}</span> : <input name="e1" id="e1" type="text" class="auto" alt="n3x3p0S" size="3" />
      <input name="e2" id="e2" type="text" class="auto" alt="n2x3p4S" size="10" />
    </fieldset>
    <input type="hidden" name="geo_pos" id="geo_pos" value="{{ geo_pos}}" />
</p>
